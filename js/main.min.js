function loadScript(){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-l8J-1yZsmU4jAXluphw5gN-qUSh_uRA&signed_in=true&callback=initialize",e.onerror=function(){alert("Oops! Google maps could not be loaded, please try again later.")},document.body.appendChild(e)}function initialize(){ko.applyBindings(new ViewModel)}var places=[{name:"Blossoming Lotus",hours:"11:00 am to 9:00 pm",address:"1713 NE 15th Ave",zipcode:"97212",url:"http://blpdx.com",latitude:"45.535536",longitude:"-122.650695",tagName:"blossominglotusportland"},{name:"Food Fight! Grocery",hours:"10:00 am to 8:00 pm",address:"1217 SE Stark St",zipcode:"97214",url:"http://www.foodfightgrocery.com",latitude:"45.519718",longitude:"-122.653300",tagName:"foodfightgrocery"},{name:"Harlow",hours:"8:00 am to 9:00 pm",address:"3632 SE Hawthorne Blvd",zipcode:"97214",url:"http://www.harlowpdx.com/",latitude:"45.511974",longitude:"-122.626056",tagName:"harlowportland"},{name:"Herbivore Clothing Co.",hours:"10:00 am to 6:00 pm",address:"1211 SE Stark St",zipcode:"97209",url:"http://www.herbivoreclothing.com/",latitude:"45.519937",longitude:"-122.653313",tagName:"herbivoreclothingcompany"},{name:"Petunia's Pies & Pastries",hours:"9:00 am to 7:00 pm",address:"610 SW 12th Ave",zipcode:"97205",url:"http://petuniaspiesandpastries.com/",latitude:"45.521157",longitude:"-122.683692",tagName:"petuniaspiesandpastries"},{name:"Portobello Vegan Trattoria",hours:"5:30 pm to 9:00 pm",address:"1125 SE Division St",zipcode:"97214",url:"http://portobellopdx.com/",latitude:"45.505438",longitude:"-122.654195",tagName:"portobellovegantrattoria"},{name:"Prasad",hours:"7:30 am to 8:00 pm",address:"925 NW Davis St",zipcode:"97209",url:"http://www.prasadcuisine.com/",latitude:"45.524797",longitude:"-122.680821",tagName:"prasadcafe"}],Location=function(e){this.name=ko.observable(e.name),this.hours=ko.observable(e.hours),this.address=ko.observable(e.address),this.zipcode=ko.observable(e.zipcode),this.url=ko.observable(e.url),this.latitude=ko.observable(e.latitude),this.longitude=ko.observable(e.longitude),this.tagName=ko.observable(e.tagName)},ViewModel=function(){var e=this;this.locationsArray=ko.observableArray([]),e.filter=ko.observable(""),markersArray=[];var a="images/purpleMarker.png",t="images/turquoiseMarker.png",o="purple",r="#666666",s="visible",n="hidden",l="veganportland",c="Vegan in Portland";e.currentLocation=ko.observable(c),places.forEach(function(a){e.locationsArray().push(new Location(a))}),e.resizeMap=function(){$(function(){$("#map").css("height",$(window).height())})},e.drawMap=function(){var o=new google.maps.LatLng(45.5224,-122.680004),r={zoom:13,center:o,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(document.getElementById("map"),r),i=new google.maps.InfoWindow({content:c}),n=0;for(n=0;n<e.locationsArray().length;n++){var l="http://maps.googleapis.com/maps/api/streetview?size=200x200&location="+e.locationsArray()[n].latitude()+","+e.locationsArray()[n].longitude(),c='<div id="content"><h3>'+e.locationsArray()[n].name()+"</h3><p>Address: "+e.locationsArray()[n].address()+"</p><p>Zipcode: "+e.locationsArray()[n].zipcode()+"</p><p>Hours: "+e.locationsArray()[n].hours()+"</p><p>"+e.locationsArray()[n].url()+'</p><img class="smImg" src="'+l+'"></div>',p=new google.maps.LatLng(e.locationsArray()[n].latitude(),e.locationsArray()[n].longitude()),d=new google.maps.Marker({position:p,map:s,title:e.locationsArray()[n].name(),icon:t});d.setMap(s),markersArray.push(d),google.maps.event.addListener(i,"closeclick",e.resetInstagram),google.maps.event.addListener(d,"click",function(t,o,r){return function(){e.nameReset(),e.markerReset(),r.setContent(o),r.open(s,t),this.setIcon(a),e.currentLocation(this.title),e.getInstagram()}}(d,c,i))}},e.nameReset=function(){$(".placeName").css("color",r)},e.markerReset=function(){for(var e=0;e<markersArray.length;e++)markersArray[e].setIcon(t)},e.openInstagram=function(){$(".photoPanel").css("visibility",s)},e.closeInstagram=function(){$(".photoPanel").css("visibility",n)},e.resetInstagram=function(){e.markerReset(),e.nameReset(),e.currentLocation(c),e.getInstagram()},e.getInstagram=function(){e.removePhotos();for(var a,t=!1,o=0;o<e.locationsArray().length;o++)if(e.currentLocation()===e.locationsArray()[o].name()){a=e.locationsArray()[o].tagName(),t=!0;break}t===!1&&(a=l);var r="1105136919.eb73d41.ba4caf5b3107446bb36aa14afdebb8a8",s="https://api.instagram.com/v1/tags/"+a+"/media/recent?access_token="+r+"&count=6";$.ajax({type:"GET",dataType:"jsonp",cache:!1,url:s,success:function(e){for(var a,t=0;6>t;t++)a=e.data[t].images.low_resolution.url,$(".photos").append("<img src='"+a+"' class='imgInstagram'></img>")}}).error(function(){$(".photoPanel").text("Oops! Instagram's photos could not be loaded. Please try again later.")})},e.removePhotos=function(){for(var e=document.getElementById("photos");e.hasChildNodes();)e.removeChild(e.firstChild)},e.showMarker=function(a,t){var r=$(t.target).text();for(e.nameReset(),e.markerReset(),i=0;i<markersArray.length;i++)r===markersArray[i].title&&(google.maps.event.trigger(markersArray[i],"click"),$(t.target).css("color",o),e.currentLocation(r))},e.stringStartsWith=function(e,a){return e=e||"",a.length>e.length?!1:e.substring(0,a.length)===a},e.filteredItems=ko.computed(function(){var a=e.filter().toLowerCase();return a?ko.utils.arrayFilter(e.locationsArray(),function(t){return e.stringStartsWith(t.name().toLowerCase(),a)}):e.locationsArray()},e.locationsArray),e.getInstagram(),e.resizeMap(),window.addEventListener("resize",e.resizeMap),this.drawMap()};window.onload=loadScript;